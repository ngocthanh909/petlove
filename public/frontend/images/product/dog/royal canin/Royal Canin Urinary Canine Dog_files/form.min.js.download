"use strict";var Form=function(e){function t(e){var t=document.getElementById(e);return"undefined"!=typeof t&&null!=t?t:!1}function n(t,n){var r=e("#info_"+t).length>0?"#info_"+t:"",a=e("#label_"+t).length>0?"#label_"+t:"",i=e("#error_format_"+t).length>0?"#error_format_"+t:"";return""!=i&&e(i).html(n),""!=r&&e(r).css("border","1px solid red"),""!=a?e(a).html():""}var r="/post.php";return{setHandle:function(e){r=e},submitFormDefaultCallback:function(r){var a=e(this).closest("form"),i=a.find(".form_status_notify");if("error"==r.status){var l="<strong>Vui lòng sửa các lỗi sau</strong>:<br>",o="";if(console.log("typeof = "+typeof r.message),"string"==typeof r.message)l+=r.message;else for(var s in r.message)if(r.message.hasOwnProperty(s)){var h=r.message[s],u=n(s,h);o+=s+",",l+=u.length>0?"- "+u+": "+h+"<br>":"- "+h+"<br>"}i.length&&i.html(l+'<input type="hidden" id="error_fields_list" value="'+o+'">').addClass("txt_14 txt_red")}else if(t("save_and_new")&&"yes"==t("save_and_new").value){var g=window.location.href;window.location=-1==g.indexOf("?id=")?g:g.substr(0,g.indexOf("?id="))}else r.hasOwnProperty("new_id")?(t("info_id")&&e("#info_id").val(r.new_id),i.length&&i.html("Tạo thành công")):i.length&&i.html("Cập nhật thành công")},submitForm:function(a,i,l){function o(){var n="";return t("info_"+k)?n=t("info_"+k).value.trim():e('input[name="info['+k+']"]:checked').length>0&&(n=e('input[name="info['+k+']"]:checked').val()),n}var s=this,h=this.value;""==a&&(a="Vui lòng chờ…");var u=e(this).closest("form"),g=u.find(".form_status_notify");if(g.html(a),"undefined"!=typeof tinyMCE&&"function"==typeof tinyMCE.triggerSave&&tinyMCE.triggerSave(),g.length){var f=u.find("#error_fields_list");if(f.length)for(var d=f.val().split(","),_=0;_<d.length;_++){var p=d[_];if(p.length>0){var v=e("#info_"+p).length>0?"#info_"+p:"",c=e("#error_format_"+p).length>0?"#error_format_"+p:"";""!=c&&e(c).html(""),""!=v&&e(v).css("border","1px solid #CCCCCC")}}g.html("")}var m=!0,y="<strong>Vui lòng sửa các lỗi sau</strong>:<br>",b="";for(var k in i)if(i.hasOwnProperty(k)){var w=i[k],x=o(k),C=!0;if(1==w.required&&x.length<1&&(m=!1,C=!1,b+=k+",",y+="- "+n(k,"Chưa nhập giá trị")+": Chưa nhập giá trị<br>"),C&&w.hasOwnProperty("rules")&&""!=x){var O=!0;if(w.rules.hasOwnProperty("data_type")){var D=w.rules.data_type;switch(D){case"date":DataType.validateData(x,"date")||(b+=k+",",y+="- "+n(k,x+" không phải ngày")+": "+x+" không phải ngày<br>",t("info_"+k).value="",O=!1);break;case"number":DataType.validateData(x,"number")||(b+=k+",",y+="- "+n(k,"Không phải là số")+": Không phải là số<br>",t("info_"+k).value="",O=!1);break;case"email":DataType.validateData(x,"email")||(b+=k+",",y+="- "+n(k,"Không phải email ("+x+")")+": Không phải email<br>",t("info_"+k).value="",O=!1);break;case"url":DataType.validateData(x,"url")||(b+=k+",",y+="- "+n(k,"Không phải url")+": Không phải url<br>",t("info_"+k).value="",O=!1);break;case"facebook":DataType.validateData(x,"facebook")||(b+=k+",",y+="- "+n(k,"Không phải Facebook url")+": Không phải Facebook url<br>",t("info_"+k).value="",O=!1)}}O&&w.rules.hasOwnProperty("min_length")&&x.length<w.rules.min_length&&(b+=k+",",y+="- "+n(k,"Tối thiểu cần "+min_length+" ký tự")+": Tối thiểu cần "+min_length+" ký tự<br>",O=!1),O&&w.rules.hasOwnProperty("max_length")&&x.length>w.rules.max_length&&(b+=k+",",y+="- "+n(k,"Tối đa "+max_length+" ký tự")+": Tối đa "+max_length+" ký tự<br>",O=!1),O&&w.rules.hasOwnProperty("fixed_length")&&x.length!=w.rules.fixed_length&&(b+=k+",",y+="- "+n(k,"Phải đúng "+fixed_length+" ký tự")+": Phải đúng "+fixed_length+" ký tự<br>",O=!1),O&&w.rules.hasOwnProperty("values")&&-1==jQuery.inArray(x,w.rules.values)&&(b+=k+",",y+="- "+n(k,x+" không đúng giá trị cho phép")+": "+x+" không đúng giá trị cho phép<br>",O=!1),O||(m=!1)}}m?(this.disabled=!0,this.value=a,e.post(r,u.serialize()).done(function(e){s.disabled=!1,s.value=h,console.log("post data "+e);var n=JSON.parse(e);if("function"==typeof l&&l.call(s,n),t("return_url")){var r=t("return_url").value;r.length>2&&(window.location=r)}})):g.length&&g.html(y+'<input type="hidden" id="error_fields_list" value="'+b+'">').addClass("txt_14 txt_red")}}}(jQuery);